var X=Object.defineProperty;var R=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var A=(t,e,a)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,H=(t,e)=>{for(var a in e||(e={}))Y.call(e,a)&&A(t,a,e[a]);if(R)for(var a of R(e))ee.call(e,a)&&A(t,a,e[a]);return t};import{_ as w,o,c as r,b as s,t as c,n as _,p as $,e as O,s as f,f as M,d,a as u,w as k,j as b,l as B,m as g,B as x,F as S,h as v,g as T,i as te,r as U,v as N,x as q,y as z,T as W}from"./index.07e0a135.js";import{I as y}from"./Input.72f51d7f.js";import{S as P,b as D,K as p,a as ae,I as F}from"./KeyLabelPair.5de9fc48.js";import{S as ne,a as I,b as C}from"./Settings.491f82f6.js";const V=t=>($("data-v-56ac921f"),t=t(),O(),t),se={class:"heading"},ie={class:"user-count"},oe=V(()=>s("span",{class:"user"}," Nutzer",-1)),re=V(()=>s("h4",{class:"heading-explanation"},"vertrauen auf vp.mailservice.kepler@gmail.com",-1)),le={inject:["mq"],props:{userCount:String}},de=Object.assign(le,{__name:"Header",setup(t){return(e,a)=>(o(),r("header",{class:_(["head",e.mq.current])},[s("h1",se,[s("span",ie,c(t.userCount),1),oe]),re],2))}});var ce=w(de,[["__scopeId","data-v-56ac921f"]]),he="/assets/mail-example-hand.88eedc76.png";const K=t=>($("data-v-c7a124da"),t=t(),O(),t),ue={class:"text-container"},me=K(()=>s("article",null,[M(" Bist du nicht auch genervt jedesmal nach einem neuen Vertretungsplan zu schauen? Und dann musst du dich auch nochmal neu anmelden und suchst ewig nach den Zeilen die dich \xFCberhaupt betreffen... Doch dagegen gibt es ein Mittel! Indem du den Kepleraner VP Service abonnierst erh\xE4lst du mit maximal 10 min\xFCtiger Verz\xF6gerung Informationen \xFCber einen neuen Plan (nur wenn sich tats\xE4chlich etwas f\xFCr dich \xE4ndert!!), wenn vorhanden erh\xE4lst du sogar noch den vom Tag danach - und zwar auch nur die Daten die du auch brauchst."),s("br"),M(" Um das Ganze noch weiter aufzuwerten, erh\xE4lst du im oberen Bild in der Email Informationen \xFCber das Wetter oder siehst andere eventabh\xE4ngige Kunstwerke. Nicht zu vergessen ist au\xDFerdem das 'Kleine aber feine Extra' mit lustigen Spr\xFCchen, interessanten Fakten oder weisen Zitaten."),s("br"),M(" Du hast dabei die Wahl zwischen Emails, wie auf dem Bild zu sehen, oder Push Benachrichtigungen (nur f\xFCr Android) die dich auf eine Webseite \xE4hnlich des Email Bildes f\xFChren. ")],-1)),ge=K(()=>s("abbr",{title:"Quelle: https://pngimg.com/image/49158 (Bild bearbeitet - Email Screenshot eingef\xFCgt)"},[s("img",{src:he,alt:"Email"})],-1)),pe={inject:["mq"],async mounted(){const t=new URLSearchParams(window.location.search);t.get("scroll")==="true"&&(await f(500),this.scrollToForm(),t.delete("scroll"),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+t.toString()))},methods:{scrollToForm(){window.scrollBy({top:1e6,left:0,behavior:"smooth"})}}},fe=Object.assign(pe,{__name:"Main",setup(t){return(e,a)=>(o(),r("main",{class:_(e.mq.current)},[s("div",ue,[s("div",null,[s("button",{class:"btn-focus",onClick:a[0]||(a[0]=n=>e.scrollToForm())},"Zum Abonnement"),s("button",{class:"btn",type:"button",onClick:a[1]||(a[1]=n=>e.$emit("requestHashReset"))},"Ich bin bereits angemeldet")]),me]),ge],2))}});var be=w(fe,[["__scopeId","data-v-c7a124da"]]);const we=s("iframe",{id:"dummy-frame",frameborder:"0"},null,-1),ve={key:0,class:"center"},ye=s("div",{class:"agb"},[s("input",{type:"checkbox",id:"accept-agb",name:"accept-agb"}),s("label",{for:"accept-agb"},"Ich akzeptiere die AGB")],-1),Se=s("button",{class:"btn-focus",type:"submit"},"Los gehts!",-1),_e={inject:["mq","os"],component:{Input:y},data(){return{modalTitle:"",modalContent:"",modalButtons:[],showModal:!1,modalMode:"",notifyMode:"mail",anrede:"",switchModel:new D([new p("pwa","Push Nachricht"),new p("mail","Per Mail")],"mail")}},mounted(){},methods:{submit(t){t.preventDefault();const e=new FormData(t.target);e.append("notify-mode",this.notifyMode),g("/User/Subscribe",{method:"POST",body:e}).then(a=>a.json()).then(a=>{a.isSuccess?(this.modalTitle="Erfolg",t.target.reset(),this.$emit("newUser")):this.modalTitle="Fehlschlag",this.modalContent=a.message+(this.notifyMode==="pwa"?" Wenn die Anfrage akzeptiert wird, wirst du eine Email erhalten.":" Sobald die Anfrage akzeptiert wird, erh\xE4lst auch du die Emails."),this.modalButtons=[],this.showModal=!0})},changeAnrede(t){this.anrede=t.target.value},switchNotifyMode(t){this.notifyMode=t},enterKeyModal(){this.modalTitle="Code eingeben",this.modalContent=`Wenn du eine Anmeldungsemail mit einem Code erhalten hast, bist du hier richtig. Gib diesen Code einfach hier ein und du bist angemeldet.<br><br>
         `,this.modalButtons=[new x("Anmelden","btn",()=>{(async()=>(await f(300),this.keyEntered()))()})],this.modalMode="enterKey",this.showModal=!0},async keyEntered(){const t=document.getElementById("hashreset-key-input").value;this.$emit("keyEntered",t)}}},Me=Object.assign(_e,{__name:"Form",setup(t){return(e,a)=>(o(),r("div",{class:_(["form-container",e.mq.current])},[we,s("form",{id:"subscribe-form",onSubmit:a[2]||(a[2]=(...n)=>e.submit&&e.submit(...n)),target:"dummy-frame"},[d(y,{type:"text",label:`Anrede -> Hallo ${e.anrede}!`,defaultValue:e.anrede,name:"name",onInput:a[0]||(a[0]=n=>e.anrede=n.target.value)},null,8,["label","defaultValue"]),d(y,{type:"text",label:"Email",name:"mail"}),d(y,{type:"number",label:"Klassenstufe",name:"grade",min:5,max:12}),e.os!="mac"?(o(),r("div",ve,[d(P,{options:e.switchModel.options,default:e.switchModel.value,onSwitch:e.switchNotifyMode},null,8,["options","default","onSwitch"])])):u("",!0),ye,Se,s("button",{class:"btn-border-invert",type:"button",onClick:a[1]||(a[1]=n=>e.$emit("requestHashReset")),style:{width:"fit-content"}}," Ich bin bereits angemeldet ")],32),d(B,{isOpen:e.showModal,onClose:a[3]||(a[3]=n=>e.showModal=!e.showModal),title:e.modalTitle,content:e.modalContent,buttons:e.modalButtons},{default:k(()=>[e.modalMode==="hashReset"?(o(),b(y,{key:0,isInvert:!0,label:"Email Addresse",id:"hashreset-mail-input"})):u("",!0)]),_:1},8,["isOpen","title","content","buttons"])],2))}}),ke={inject:["fetchAPI"],data(){return{userCount:"#"}},async mounted(){this.getUserCount()},methods:{getUserCount(){g("/User/UserCount").then(t=>t.json()).then(t=>{t.isSuccess&&(this.userCount=t.body)})},newUser(){window.scrollBy({top:-99999,left:0,behavior:"smooth"}),setTimeout(this.getUserCount,1e3)}}},Ce=Object.assign(ke,{__name:"Index",setup(t){return(e,a)=>(o(),r(S,null,[d(ce,{userCount:e.userCount},null,8,["userCount"]),d(be,{onRequestHashReset:a[0]||(a[0]=n=>e.$emit("requestHashReset"))}),d(Me,{onNewUser:a[1]||(a[1]=n=>e.newUser()),onRequestHashReset:a[2]||(a[2]=n=>e.$emit("requestHashReset"))})],64))}});class G{constructor(e,a,n,i,l,m,h){this.affectedDate=e,this.affectedWeekday=a,this.originDate=n,this.originTime=i,this.announcements=l,this.missingTeachers=m,this.rows=h}}const xe={props:{color:{type:String,required:!0},plan:{required:!0,type:G}}},J=t=>($("data-v-544565d9"),t=t(),O(),t),Te={key:0,class:"announcements border-box"},$e=J(()=>s("br",null,null,-1)),Oe={class:"missing-teachers border-box"},Be={key:1},De=J(()=>s("tr",null,[s("th",null,"Klasse"),s("th",null,"Stunde"),s("th",null,"Fach"),s("th",null,"Lehrer"),s("th",null,"Raum"),s("th",null,"Info")],-1)),Ee={key:2,class:"center"};function Ie(t,e,a,n,i,l){var m;return o(),r("div",{class:"box plan-box",style:v({borderTopColor:a.color})},[s("h4",{class:"weekday",style:v({textDecorationColor:a.color})},c(a.plan.affectedWeekday),5),a.plan.announcements.length>0?(o(),r("div",Te,[(o(!0),r(S,null,T(a.plan.announcements,h=>(o(),r("span",{key:h},[M(c(h),1),$e]))),128))])):u("",!0),s("div",Oe,"Es fehlen: "+c(a.plan.missingTeachers.join(",")),1),((m=a.plan.rows)==null?void 0:m.length)>0?(o(),r("table",Be,[De,(o(!0),r(S,null,T(a.plan.rows,h=>(o(),r("tr",{key:h,style:v({color:h.hasChange?h.isDeleted?"red":a.color:""})},[s("td",null,c(h.row.klasse),1),s("td",null,c(h.row.stunde),1),s("td",null,c(h.row.fach),1),s("td",null,c(h.row.lehrer),1),s("td",null,c(h.row.raum),1),s("td",null,c(h.row.info),1)],4))),128))])):(o(),r("p",Ee,"Keine \xC4nderungen..."))],4)}var Le=w(xe,[["render",Ie],["__scopeId","data-v-544565d9"]]);const Pe={props:{color:{type:String,required:!0},text:{type:String,required:!0},author:String}},je=t=>($("data-v-633a6e77"),t=t(),O(),t),Re=je(()=>s("h4",null,[s("b",null,"Kleines, aber feines Extra")],-1)),Ae=["innerHTML"],He={key:0};function Ne(t,e,a,n,i,l){var m;return o(),r(S,null,[Re,s("blockquote",{style:v({borderColor:a.color}),innerHTML:a.text},null,12,Ae),((m=a.author)==null?void 0:m.length)>0?(o(),r("p",He,"~"+c(a.author),1)):u("",!0)],64)}var qe=w(Pe,[["render",Ne],["__scopeId","data-v-633a6e77"]]);const ze={class:"data-space"},Fe=["src","alt"],Ue={class:"box text-center"},We=M(),Ve=s("br",null,null,-1),Ke={class:"plan-box"},Ge=s("button",{class:"btn"},[s("a",{href:"https://jkg-leipzig.de/vertretungsplan/"},"Schulseite")],-1),Je={class:"btn"},Qe=M("Kleines Extra beitragen"),Ze={class:"box small-extra"},Xe={key:0,class:"account-logo-container"},Ye={class:"box"},et=s("div",{id:"webpushr-subscription-button","data-show-subscriber-count":"false","data-button-text":"Benachrichtigung erlauben","data-subscriber-count-text":"","data-background-color":"#ff8ded"},null,-1),tt={class:"switches"},at={class:"box qrcode-container"},nt=s("summary",null,"QR Code",-1),st=["src"],it={inject:["mq"],props:{isHashResetResponseModalOpen:Boolean},data(){return{imgSrc:"",qrCodeSrc:"/api/Notification/QrCode",globalExtra:"",grade:"",title:"",affectedDate:"",originDate:"",originTime:"",plans:[],extraText:"",extraAuthor:"",userName:"",color:"",tempMax:"",tempMin:"",modalTitle:"",modalContent:"",showModal:!1,_switches:{color:new D([new p("darkmode","Dunkelmodus"),new p("lightmode","Hellmodus")],localStorage.getItem("color-scheme")),notifyMode:new D([new p("pwa","Push Nachricht"),new p("mail","Per Mail")],"pwa")},isNotifyModeUpdated:!1,notifyMode:"",isPushButOnOtherDevice:!1,colorScheme:"darkmode"}},beforeMount(){localStorage.setItem("device-was-logged-in","true"),this.fetchData()},async mounted(){await this.loadNotifyMode(),await this.handleDeviceChange()},methods:{async fetchData(){var m;this.loadCachedData();const t=!await this.isPlanNew(),e=await Promise.allSettled([this.fetchModel("Global",t),this.fetchModel("Grade",t),this.fetchModel("User",t)]),a=e[0].value,n=e[1].value,i=e[2].value;this.userName=i.userName||"Kepleraner",this.artworkName=((m=a.artwork)==null?void 0:m.name)||"",this.imgSrc=`/api/Notification/Artwork/${this.artworkName}/${this.userName}`,this.globalExtra=a.globalExtra||"Moin",this.tempMax=a.weather.tempMax,this.tempMin=a.weather.tempMin,this.plans=this.makePlans(a,n),console.log(this.plans),this.originDate=this.plans[0].originDate,this.originTime=this.plans[0].originTime,this.affectedDate=this.plans[0].affectedDate,this.grade=n.grade,this.globalExtra=n.gradeExtra!==null?n.gradeExtra:this.globalExtra,this.extraText=i.smallExtra.text,this.extraAuthor=i.smallExtra.author,this.color=a.artwork.color,this.title=a.subject;const l=this.handleLastPlan(a,n);l!==null&&this.plans.push(l),this.ensurePlanColorContrast(),localStorage.setItem("greeting",this.userName),localStorage.setItem("last-origin-datetime",`${this.originDate}, ${this.originTime}`),localStorage.setItem("last-affected-date",this.affectedDate)},async loadCachedData(){var i;const t=await Promise.allSettled([this.fetchModel("Global",!0),this.fetchModel("Grade",!0),this.fetchModel("User",!0)]),e=t[0].value,a=t[1].value,n=t[2].value;this.title="Lade...",e!==null&&(this.globalExtra=e.globalExtra||"Moin",this.affectedDate=e.affectedDate||"",this.originDate=e.originDate||"",this.originTime=e.originTime||"",this.tempMax=e.weather.tempMax,this.tempMin=e.weather.tempMin,this.missingTeachers=((i=e.missingTeachers)==null?void 0:i.map(l=>l.trim()))||[],this.information=e.information||[],this.color=e.artwork.color),a!==null&&(this.grade=a.grade,this.globalExtra=a.gradeExtra!==null?a.gradeExtra:this.globalExtra),e!==null&&a!==null&&(this.plans=this.makePlans(e,a)),n!==null&&(this.userName=n.userName||"Kepleraner",this.extraText=n.smallExtra.text,this.extraAuthor=n.smallExtra.author)},makePlans(t,e){const a=[];for(let n=0;n<t.globalPlans.length;n++){const i=t.globalPlans[n],l=e.listOfTables[n];a.push(new G(i.affectedDate,i.affectedWeekday,i.originDate,i.originTime,i.announcements,i.missingTeachers,l))}return a},fetchModel(t,e){return new Promise(async(a,n)=>{if(e){const i=localStorage.getItem(`${t}-model`);if((i==null?void 0:i.length)>0)return a(JSON.parse(i))}try{let i=await g(`/Notification/${t}Model`).then(l=>l.json());if(i.isSuccess)return localStorage.setItem(`${t}-model`,JSON.stringify(i.body)),a(i.body);this.modalTitle="Fehlschlag",this.modalContent=i.message}catch{this.modalTitle="Fehlschlag",this.modalContent=navigator.isOnline?"Leider ist etwas schief gelaufen":"Du bist offline. Deswegen werden gespeicherte Daten angezeigt, die veraltet sein k\xF6nnen."}return this.showModal=!0,n()})},handleLastPlan(t,e){let a=localStorage.getItem("last-plan-model");return a!==null&&(a=JSON.parse(a)),console.log(a),new Date().getDate()===parseInt(a==null?void 0:a.affectedDate.slice(0,2))?((e==null?void 0:e.listOfTables[0].affectedDate)===(a==null?void 0:a.affectedDate)&&(a=this.setLastPlan(t,e)),a.affectedWeekday+=" (heute)",a):(this.setLastPlan(t,e),null)},setLastPlan(t,e){t.globalPlans=[t.globalPlans[0]],e.listOfTables=[e.listOfTables[0]];const a=this.makePlans(t,e)[0];return localStorage.setItem("last-plan-model",JSON.stringify(a)),a},async isPlanNew(){try{const t=localStorage.getItem("current-plan-id");let e=await g("/Notification/CurrentPlanId").then(a=>a.json());if(e.isSuccess)return localStorage.setItem("current-plan-id",e.body),t!==e.body}catch{}return!0},reload(){localStorage.setItem("last-origin-datetime","reload"),this.fetchData()},async loadNotifyMode(t=null){try{if(t===null){let a=await g("/User/GetNotifyMode").then(n=>n.json());a.isSuccess&&(t=a.body.toLowerCase()==="pwa"?"pwa":"mail")}}catch{}this.notifyMode=t;const e=H({},this._switches.notifyMode);e.value=t,delete this._switches.notifyMode,await f(0),this._switches=Object.assign(this._switches,{notifyMode:e}),await f(0),this.isNotifyModeUpdated=!0},switchMode(t,e){switch(t){case"color":this.colorScheme=e,this.changeColorScheme(e);break;case"notifyMode":this.isNotifyModeUpdated&&this.changeNotifyMode(e);break}},changeColorScheme(t){this.$emit("changeColorScheme",t),this.ensurePlanColorContrast()},ensurePlanColorContrast(){const t=this.colorScheme==="lightmode"?500:350,e=h=>parseInt(h,16),a=h=>Math.round(h).toString(16);let n=e(this.color.slice(1,3)),i=e(this.color.slice(3,5)),l=e(this.color.slice(5,7));const m=t/(n+i+l);this.colorScheme==="darkmode"&&m<1||this.colorScheme==="lightmode"&&m>1||(n*=m,i*=m,l*=m,this.color=`#${a(n)}${a(i)}${a(l)}`)},async changeNotifyMode(t){if(t==="pwa"){this.dispatchRegisterPushEvent();let e=0;for(;e++,Notification.permission!=="granted";){if(Notification.permission==="denied"){alert("Wenn du die Benachrichtigung nicht akzeptiers, kannst du keine Push Nachrichten erhalten. "),this.loadNotifyMode("mail");return}e===30&&(this.dispatchRegisterPushEvent(),e=0),await f(500)}}try{let e=await g(`/User/ChangeNotifyMode/${t}`,{method:"POST"}).then(a=>a.json());if(this.modalContent=e.message,e.isSuccess){this.modalTitle="Erfolg",this.showModal=!0;return}}catch{this.modalContent="Leider ist etwas schief gelaufen."}this.modalTitle="Fehlschlag",this.showModal=!0},async handleDeviceChange(){if(this.notifyMode!=="pwa")return;if(sessionStorage.getItem("rejected-device-change")==="true"){this.isPushButOnOtherDevice=!0;return}const t=await g("/User/GetPushSubscribtion").then(i=>i.json());if(!t.isSuccess)return;const e=t.body,a=await navigator.serviceWorker.ready.then(i=>i.pushManager.getSubscription().then(l=>l));if(e===JSON.stringify(a))return;if(!confirm("Du hast Push Benachrichtigungen eingestellt, jedoch werden diese zurzeit an ein anderes Ger\xE4t gesendet. Willst du stattdessen dieses Ger\xE4t verwenden?")){this.isPushButOnOtherDevice=!0,sessionStorage.setItem("rejected-device-change","true");return}this.dispatchRegisterPushEvent()},dispatchRegisterPushEvent(){window.dispatchEvent(new Event("registerpush")),this.isPushButOnOtherDevice=!1}}},ot=Object.assign(it,{__name:"Index",setup(t){return(e,a)=>{const n=U("RouterLink");return o(),r("div",{class:_([e.mq.current,"notif-page"]),ref:"page"},[s("div",ze,[s("img",{src:e.imgSrc,class:"artwork",alt:e.imgSrc},null,8,Fe),e.tempMax!==null?(o(),r("div",{key:0,class:"text-center",style:v({color:e.color})},c(e.tempMin)+"/"+c(e.tempMax)+"\xB0C",5)):u("",!0),s("h2",{class:"global-extra",style:v({color:e.color})},c(e.globalExtra),5),s("div",Ue,[s("b",null,c(e.title),1),We,Ve,s("i",null,"(vom "+c(e.originDate)+" um "+c(e.originTime)+" Uhr.)",1)]),s("div",Ke,[(o(!0),r(S,null,T(e.plans,i=>(o(),r("div",{key:i},[d(Le,{color:e.color,plan:i},null,8,["color","plan"])]))),128))]),s("div",{class:"box link-container",style:v({color:e.color})},[Ge,s("button",Je,[d(n,{to:"/Mitmachen"},{default:k(()=>[Qe]),_:1})])],4),s("div",Ze,[d(qe,{color:e.color,text:e.extraText,author:e.extraAuthor},null,8,["color","text","author"])])]),e.mq.tabletMinus?(o(),r("hr",{key:0,style:v({borderColor:e.color})},null,4)):u("",!0),s("div",{class:_(["user-space",t.isHashResetResponseModalOpen&&e.mq.current==="mobile"?"add-scroll-padding":""])},[e.mq.desktopPlus?(o(),r("div",Xe,[s("div",{class:"account-logo",style:v({color:e.color})},[d(te,{name:"account"})],4)])):u("",!0),s("div",Ye,[et,s("div",tt,[(o(!0),r(S,null,T(e._switches,(i,l)=>(o(),b(P,{key:l,invert:!0,options:i.options,default:i.value,value:i.value,onSwitch:m=>e.switchMode(l,m)},null,8,["options","default","value","onSwitch"]))),128))]),s("button",{class:"btn",onClick:a[0]||(a[0]=()=>e.reload())},"Neuladen"),e.isPushButOnOtherDevice?(o(),r("button",{key:0,class:"btn",onClick:a[1]||(a[1]=()=>e.dispatchRegisterPushEvent())}," Erhalte Push Nachrichten auf diesem Ger\xE4t ")):u("",!0)])],2),s("details",at,[nt,s("img",{src:e.qrCodeSrc,alt:"QR Code",loading:"lazy"},null,8,st)]),d(B,{isOpen:e.showModal,onClose:a[2]||(a[2]=i=>e.showModal=!e.showModal),title:e.modalTitle,content:e.modalContent,buttons:[]},null,8,["isOpen","title","content"])],2)}}});const rt={class:"content lernsax-settings"},lt={key:0},dt={inject:["colorScheme"],props:{methodOnMount:Object},data(){return{modalTitle:"",modalContent:"",showModal:!1,modalMode:"",modalButtons:[],modalMode:"",services:Object.freeze(["mail"]),subbedServices:[],loadCompleted:!1,settings:[new I("Meine Daten",[new C("change-creds","Anmeldedaten \xE4ndern","Hier kannst du deine Lernsaxdaten (Email und Passwort) angeben.",[new p("change","\xC4ndern")]),new C("delete-creds","Anmeldedaten l\xF6schen","Wenn du deine Lernsax-Anmeldedaten l\xF6schst musst du auf alle Lernsax Service verzichten. Alle Daten die bereits geladen wurden sind (bspw. Emails) bleiben erhalten, es kommen jedoch keine neuen mehr hinzu.",[new p("delete","L\xF6schen")]),new C("delete-data","Alle Daten l\xF6schen","Wenn du auf 'L\xF6schen' dr\xFCckst, werden alle deine hier verwendeten Lernsaxdaten (Anmeldedaten + bereits geladene Daten wie Emails) gel\xF6scht. ",[new p("delete","L\xF6schen")])])]}},computed:{scheme(){return this.colorScheme()}},async beforeMount(){var t,e;await this.loadServices(),await this.loadLaterSettings(),await f(100),this.loadCompleted=!0,typeof((t=this.methodOnMount)==null?void 0:t.value)=="string"&&typeof((e=this.methodOnMount)==null?void 0:e.option)=="string"&&this.settingChange(this.methodOnMount)},mounted(){},methods:{closeModal(){this.modalMode="",this.modalButtons=[],this.showModal=!1},settingChange(t){const e=t.value==="activate"?L.subscribe:L.unsubscribe;switch(t.option){case"mail-service":this.loadCompleted&&this.de_activateService("mail",e);break;case"change-creds":this.openChangeCredsModal();break;case"delete-creds":this.deleteCreds();break;case"delete-data":this.deleteAll();break;case"change-colorscheme":this.$emit("changeColorScheme",t.value);break}},async loadServices(){const t=await g("/Lernsax/SubscribedServices").then(e=>e.json());this.subbedServices=Array.isArray(t.body)?t.body:[]},async getServiceStatus(t){const e=this.services.indexOf(t);return this.subbedServices.includes(e)?"activate":"deactivate"},async loadLaterSettings(){const t=new I("Services",[new C("mail-service","Email","Aktiviere den Service, wenn du Push-Nachrichten \xFCber neue Lernsaxemails erhalten willst und diese auch unkompliziert auf dieser Seite anschauen willst.",[new p("activate","Aktivieren"),new p("deactivate","Deaktivieren")],await this.getServiceStatus("mail"))]),e=new I("Aussehen",[new C("change-colorscheme","Farbschema","Hier kannst du zwischen Hell- und Dunkelmodus wechseln.",[new p("darkmode","Dunkelmodus"),new p("lightmode","Hellmodus")],this.scheme)]);this.settings=[...this.settings,t,e]},async de_activateService(t,e){const a=this.services.indexOf(t);e===L.subscribe&&window.dispatchEvent(new Event("registerpush"));try{const n=await g(`/Lernsax/Services/${e}/${a}`,{method:"POST"}).then(i=>i.json());this.modalTitle="Fehlschlag",n.isSuccess&&(this.modalTitle="Erfolg"),this.modalContent=n.message}catch{this.modalTitile="Fehlschlag",this.modalContent="Leider ist etwas schief gelaufen."}this.showModal=!0},openChangeCredsModal(){this.modalMode="change-creds",this.modalTitle="Anmeldedaten \xE4ndern",this.modalContent="Wenn du die Lernsax Services nutzen willst musst du vorher deine Lernsax-Anmeldedaten angeben. Die Daten werden verschl\xFCsselt gespeichert. Beachte jedoch, dass du dem Betreiber der Seite damit deine Daten anvertraust und dieser theoretisch die Daten einsehen kann. Vielen Dank f\xFCr dein Vertrauen.",this.modalButtons=[new x("Speichern","btn",this.changeCreds)],this.showModal=!0},async changeCreds(){const t=document.getElementById("lernsax-mail-input").value,e=document.getElementById("lernsax-pw-input").value,a=new FormData;a.append("mail",t),a.append("password",e),window.dispatchEvent(new Event("startloading"));try{const n=await g("/Lernsax/SetCredentials",{method:"POST",body:a}).then(i=>i.json());if(window.dispatchEvent(new Event("endloading")),this.modalContent=n.message,n.isSuccess){this.modalTitle="Erfolg",this.showModal=!0;return}}catch{window.dispatchEvent(new Event("endloading")),this.modalContent="Leider ist etwas schief gelaufen. Bitte versuche es erneut."}this.modalTitle="Fehlschlag",this.modalButtons=[new x("Erneut versuchen","btn",async()=>{await f(500),this.openChangeCredsModal()})],this.showModal=!0},async deleteCreds(){if(!!confirm("Bist du sicher, dass du deine Lernsax Anmeldedaten von Kepleraner l\xF6schen willst?")){window.dispatchEvent(new Event("startloading"));try{const t=await g("/Lernsax/Credentials",{method:"DELETE"}).then(e=>e.json());this.modalTitle="Fehlschlag",this.modalContent=t.message,t.isSuccess&&(this.modalTitle="Erfolg")}catch{this.modalTitle="Fehlschlag",this.modalContent="Leider ist etwas schief gelaufen. Bitte versuche es erneut."}this.showModal=!0,window.dispatchEvent(new Event("endloading"))}},async deleteAll(){if(!!confirm("Bist du sicher, dass du alle deine Lernsaxdaten von Kepleraner l\xF6schen willst?")){window.dispatchEvent(new Event("startloading")),await window.lernsaxDB.transaction(["mails"],"readwrite").objectStore("mails").clear(),localStorage.setItem("ls-service-mail-heads","");try{const t=await g("/Lernsax/All",{method:"DELETE"}).then(e=>e.json());this.modalTitle="Fehlschlag",this.modalContent=t.message,t.isSuccess&&(this.modalTitle="Erfolg")}catch{this.modalTitle="Fehlschlag",this.modalContent="Leider ist etwas schief gelaufen. Bitte versuche es erneut."}this.showModal=!0,window.dispatchEvent(new Event("endloading"))}}}};class L{static get subscribe(){return"Subscribe"}static get unsubscribe(){return"Unsubscribe"}}const ct=Object.assign(dt,{__name:"LernsaxSettings",setup(t){return(e,a)=>(o(),r("div",rt,[d(ne,{settings:e.settings,onSettingChange:e.settingChange},null,8,["settings","onSettingChange"]),d(B,{isOpen:e.showModal,onClose:a[0]||(a[0]=()=>e.closeModal()),title:e.modalTitle,content:e.modalContent,buttons:e.modalButtons},{default:k(()=>[e.modalMode==="change-creds"?(o(),r("div",lt,[d(y,{isInvert:!0,label:"Lernsax Emailadresse",id:"lernsax-mail-input"}),d(y,{isInvert:!0,label:"Lernsax Passwort",type:"password",id:"lernsax-pw-input"})])):u("",!0)]),_:1},8,["isOpen","title","content","buttons"])]))}});var ht=w(ct,[["__scopeId","data-v-19bbfb1f"]]);const ut={props:{number:{type:Number,required:!0},bodies:{type:Array,required:!0}},data(){return{head:"",body:""}},updated(){this.loadHeadAndBody()},mounted(){this.loadHeadAndBody()},methods:{loadHeadAndBody(){const t=this.bodies[0];if(this.number===0){this.head=null,this.body=t==null?void 0:t.replaceAll(`\r
`,"<br>");return}const e=t.split(`\r
`);this.head=this.improveHead(e.slice(1,7).join("|")),this.body=e.slice(7).join("<br>").split("<br>"+">".repeat(this.number)).join("<br>").slice(this.number-1)},improveHead(t){const e=(h,E,Z)=>{const j=h.indexOf(E);return h.slice(j+E.length,h.indexOf(Z,j+E.length))};let a=t.split("|");a.length===1&&(a=t.split(`\r
`));const n=e(a[0],'From: "','"'),i=e(a[2],'To: "','"'),l=a[1].slice(9);return`
            <b>${a[3].slice(9)}</b><br>
            Von <u>${n}</u> an <u>${i}</u><br>
            ${l}
         `}}},mt=["innerHTML"],gt=["innerHTML"];function pt(t,e,a,n,i,l){const m=U("MailBody",!0);return o(),r("div",{class:_({showIndentation:a.number>0})},[s("div",null,[i.head!==null?(o(),r("div",{key:0,class:"body-head",innerHTML:i.head},null,8,mt)):u("",!0),s("div",{class:"body-body",innerHTML:i.body},null,8,gt)]),a.bodies.length>1?(o(),b(m,{key:0,number:a.number+1,bodies:a.bodies.slice(1)},null,8,["number","bodies"])):u("",!0)],2)}var ft=w(ut,[["render",pt],["__scopeId","data-v-ebdadea0"]]);const Q=t=>($("data-v-f1024dba"),t=t(),O(),t),bt={class:"mail box",ref:"mail"},wt={class:"subject"},vt={class:"flex"},yt={class:"sender"},St={class:"datetime"},_t={key:0,class:"mail-body-container"},Mt=Q(()=>s("hr",null,null,-1)),kt={class:"btn-container flex"},Ct={key:0,class:"answering-container"},xt={class:"mail-bodies"},Tt=["innerHTML"],$t={class:"btn-container flex"},Ot=Q(()=>s("a",null,"Lernsax \xF6ffnen",-1)),Bt=[Ot],Dt={props:{open:{type:Boolean,required:!0},subject:{type:String,required:!0},sender:{type:String,required:!0},senderDisplayName:{type:String},dateTime:{type:String,required:!0},id:{type:String,required:!0},preLoad:{type:Boolean,required:!0},wasOpen:{type:Boolean,required:!0}},data(){return{rawBody:"",bodies:[],isImproved:!1,displayRaw:!1,isAnswering:!1,mailBodyToSend:"",mailSubjectToSend:""}},async mounted(){await f(1e3),this.preLoad&&this.loadBody(),this.mailSubjectToSend="Re:"+this.subject,console.log(this.subject)},updated(){this.wasOpen&&this.closeMail(!1)},methods:{async toggleOpen(){const t=!this.open;t&&this.loadBody(),this.$emit("toggleOpen",{id:this.id,isClosing:this.open,isOpening:!this.open,setWasOpen:!0}),await f(550),t&&window.scrollBy({top:this.$refs.mail.getBoundingClientRect().top-window.innerHeight*.1,behavior:"smooth"})},async closeMail(t=!0){const e=this.$refs.mail.getBoundingClientRect(),a=e.top-window.innerHeight*.1,n=-(this.$refs.mail.getBoundingClientRect().height-80);let i=Math.abs(a)<Math.abs(n)?a:n;this.$refs.mail.offsetTop+e.height>document.documentElement.scrollHeight-e.height&&t&&(i=n),window.scrollBy({top:i,behavior:"smooth"}),t&&this.$emit("toggleOpen",{id:this.id,isClosing:this.open,isOpening:!this.open,setWasOpen:!1})},async loadBody(){this.displayRaw=localStorage.getItem("ls-service-mail-displayRaw")==="true";try{this.rawBody=await this.getFromDb(this.id),this.bodies=this.splitRawBody(this.rawBody);return}catch{if(!navigator.onLine){this.rawBody="Die Email kann nicht geladen werden, weil du offline bist.",this.bodies=[this.rawBody];return}}const t=await g(`/Lernsax/Service/Mail/MailBody/${this.id}`).then(e=>e.json());if(t.isSuccess){this.rawBody=t.body,this.bodies=this.splitRawBody(this.rawBody),window.lernsaxDB.transaction(["mails"],"readwrite").objectStore("mails").add({mail:this.rawBody,mailId:this.id});return}this.rawBody="***Leider ist etwas schief gelaufen. Bitte \xF6ffne die Email in Lernsax.***",this.bodies=[]},splitRawBody(t){const e=t.replaceAll("<q>","").replaceAll("</q>","").split("-----Original Message-----");for(let a=1;a<e.length;a++)e[a]=e[a].replaceAll(`<br>${"&gt;".repeat(a)}`,"<br>");return e.length>1&&(this.isImproved=!0),e},getFromDb(t){return new Promise(async(e,a)=>{const n=await window.lernsaxDB.transaction(["mails"]).objectStore("mails").get(t);n.onsuccess=i=>{if(i.target.result===void 0)return a();e(i.target.result.mail)},n.onerror=i=>{a()}})},openLernsax(){window.open("https://www.lernsax.de/wws/9.php#/wws/105592.php")},toggleRawBody(){localStorage.setItem("ls-service-mail-displayRaw",!this.displayRaw),this.displayRaw=!this.displayRaw},toggleAnswer(){this.isAnswering=!this.isAnswering},async sendAnswer(){const t=await g("/Lernsax/Service/Mail/Send",{method:"POST",body:JSON.stringify({receiver:this.sender,subject:this.mailSubjectToSend,body:this.mailBodyToSend})}).then(e=>e.json());if(t.isSuccess){this.$emit("showModal",{title:"Erfolg",content:"Die Email wurde erfolgreich versendet."}),this.mailBodyToSend="",this.mailSubjectToSend="";return}this.$emit("showModal",{title:"Fehlschlag",content:t.message})}}},Et=Object.assign(Dt,{__name:"Mail",setup(t){return(e,a)=>(o(),r("div",bt,[s("div",{class:"mail-head",onClick:a[0]||(a[0]=(...n)=>e.toggleOpen&&e.toggleOpen(...n))},[s("p",wt,c(t.subject),1),s("div",vt,[s("p",yt,c(t.senderDisplayName.length>0?t.senderDisplayName:t.sender),1),s("p",St,c(t.dateTime),1)])]),d(W,{name:"height-fade"},{default:k(()=>[t.open?(o(),r("div",_t,[Mt,s("div",kt,[e.isImproved?(o(),r("button",{key:0,class:"btn-border center",onClick:a[1]||(a[1]=(...n)=>e.toggleRawBody&&e.toggleRawBody(...n))},c(e.displayRaw?"Verbessert anzeigen":"Original anzeigen"),1)):u("",!0),s("button",{class:"btn-border center",onClick:a[2]||(a[2]=(...n)=>e.toggleAnswer&&e.toggleAnswer(...n))},c(e.isAnswering?"Abbrechen":"Antworten"),1)]),e.isAnswering?(o(),r("div",Ct,[N(s("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>z(mailSubjectToSend)?mailSubjectToSend.value=n:null),type:"text",placeholder:"Betreff"},null,512),[[q,e.mailSubjectToSend]]),N(s("textarea",{"onUpdate:modelValue":a[4]||(a[4]=n=>z(mailBodyToSend)?mailBodyToSend.value=n:null),placeholder:"Text"},null,512),[[q,e.mailBodyToSend]]),s("button",{class:"btn-focus center send-btn",onClick:a[5]||(a[5]=(...n)=>e.sendAnswer&&e.sendAnswer(...n))},"Antworten")])):u("",!0),s("div",xt,[e.displayRaw?(o(),r("div",{key:0,innerHTML:e.rawBody},null,8,Tt)):(o(),b(ft,{key:1,number:0,bodies:e.bodies},null,8,["bodies"]))]),s("div",$t,[s("button",{class:"btn-border center",onClick:a[6]||(a[6]=(...n)=>e.openLernsax&&e.openLernsax(...n))},Bt),s("button",{class:"btn-border center",onClick:a[7]||(a[7]=(...n)=>e.closeMail&&e.closeMail(...n))},"Schlie\xDFen")])])):u("",!0)]),_:1})],512))}});var It=w(Et,[["__scopeId","data-v-f1024dba"]]);const Lt={class:"content"},Pt={key:0,class:"search-options"},jt={class:"flex search-buttons"},Rt={class:"mails"},At={key:0,class:"no-mails-found"},Ht={key:0},Nt={inject:["colorScheme"],data(){return{allMailHeads:[],renderedMailHeads:[],isSearching:!1,searchString:"",showModal:!1,modalTitle:"",modalContent:""}},beforeMount(){try{this.allMailHeads=JSON.parse(localStorage.getItem("ls-service-mail-heads")),this.renderedMailHeads=JSON.parse(localStorage.getItem("ls-service-mail-heads"))}catch{}this.loadMailHeads()},mounted(){},computed:{scheme(){return this.colorScheme()}},methods:{async loadMailHeads(){const t=await g("/Lernsax/Service/Mail/Heads").then(a=>a.json());let e;for(let a=0;a<t.body.length;a++){const n=t.body[a];n.open=!1,n.wasOpen=!1,n.preLoad=a<3;const i=new Date(Date.parse(n.dateTime));let l;i.addDays(1).valueOf()>Date.now()?l="ein Tag":i.addDays(2).valueOf()===Date.now()?l="zwei Tage":i.addDays(8).valueOf()>Date.now()?l="diese Woche":i.addDays(31).valueOf()>Date.now()?l="\xE4lter als eine Woche":i.addDays(365).valueOf()>Date.now()?l="\xE4lter als ein Monat":l="\xE4lter als ein Jahr",l!==e&&(e=l,n.timeLabel=l),n.dateTime=new Intl.DateTimeFormat("de-DE",{dateStyle:"short",timeStyle:"short"}).format(i)}this.renderedMailHeads=t.body,this.allMailHeads=t.body,localStorage.setItem("ls-service-mail-heads",JSON.stringify(this.allMailHeads))},startSearching(t){this.isSearching=!0,t.target.value.length>0&&this.inputSearch(t.target.value)},inputSearch(t){typeof t!="string"||!this.isSearching||(this.searchString=t,t=t.toLowerCase(),this.renderedMailHeads=this.allMailHeads.filter(e=>e.subject.toLowerCase().includes(t)||e.sender.toLowerCase().includes(t)||e.dateTime.toLowerCase().includes(t)))},endSearching(){this.isSearching=!1,this.renderedMailHeads=[...this.allMailHeads]},async searchBodies(){window.dispatchEvent(new Event("startloading"));const t=new FormData;t.append("search",this.searchString.toLowerCase());try{const e=await g("/Lernsax/Service/Mail/SearchBody",{method:"POST",body:t}).then(a=>a.json());if(window.dispatchEvent(new Event("endloading")),e.isSuccess){console.log(this.allMailHeads),this.renderedMailHeads=e.body.map(a=>this.allMailHeads.find(n=>n.id===a));return}}catch{}this.renderedMailHeads=[],window.dispatchEvent(new Event("endloading"))},async handleToggleOpen(t){this.renderedMailHeads=this.renderedMailHeads.map(e=>(e.wasOpen=!1,e.open&&(e.wasOpen=t.setWasOpen),e.open=!1,t.isOpening&&t.id===e.id&&(e.open=!0),e))},handleShowModal(t){this.showModal=!0,this.modalTitle=t.title,this.modalContent=t.content},scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}}};Date.prototype.addDays=function(t){let e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e};const qt=Object.assign(Nt,{__name:"Mails",setup(t){return(e,a)=>(o(),r(S,null,[s("div",Lt,[d(y,{label:"Suchen...",isInvert:e.scheme==="lightmode",onFocus:e.startSearching,onBlur:a[0]||(a[0]=n=>n.target.value.length===0&&e.endSearching()),onInput:e.inputSearch},null,8,["isInvert","onFocus","onInput"]),d(W,{name:"height-fade",mode:"out-in"},{default:k(()=>[e.isSearching?(o(),r("div",Pt,[s("div",jt,[s("button",{class:"btn",onClick:a[1]||(a[1]=(...n)=>e.searchBodies&&e.searchBodies(...n))},"Im Text suchen"),s("button",{class:"btn",onClick:a[2]||(a[2]=(...n)=>e.endSearching&&e.endSearching(...n))},"Abbrechen")])])):u("",!0)]),_:1}),s("div",Rt,[e.renderedMailHeads.length===0?(o(),r("p",At,"Es wurden keine Emails gefunden...")):u("",!0),(o(!0),r(S,null,T(e.renderedMailHeads,n=>(o(),r("div",{key:n.id},[typeof n.timeLabel=="string"?(o(),r("fieldset",Ht,[s("legend",null,c(n.timeLabel),1)])):u("",!0),d(It,{sender:n.sender,senderDisplayName:n.senderDisplayName,subject:n.subject,dateTime:n.dateTime,id:n.id,open:n.open,wasOpen:n.wasOpen,preLoad:n.preLoad,onToggleOpen:e.handleToggleOpen,onShowModal:e.handleShowModal},null,8,["sender","senderDisplayName","subject","dateTime","id","open","wasOpen","preLoad","onToggleOpen","onShowModal"])]))),128))]),s("footer",null,[s("button",{class:"btn scroll-top-btn",onClick:a[3]||(a[3]=(...n)=>e.scrollToTop&&e.scrollToTop(...n))},"Nach oben")])]),d(B,{isOpen:e.showModal,onClose:a[4]||(a[4]=n=>e.showModal=!e.showModal),title:e.modalTitle,content:e.modalContent,buttons:[]},null,8,["isOpen","title","content"])],64))}});var zt=w(qt,[["__scopeId","data-v-00b7f3a6"]]);const Ft={class:"scroll-selector center"},Ut={class:"content-space"},Wt={inject:["mq"],data(){return{page:"",items:[new F("Einstellungen","settings"),new F("Email","email")],settingsMethodOnMount:{}}},async beforeMount(){this.page=this.getPage(),this.dbSetup(),await this.hasValidCredentials()||(await f(500),this.settingsMethodOnMount={option:"change-creds",value:""},this.switchPage("settings"),await f(500),this.settingsMethodOnMount=null)},methods:{getPage(){const t=new URLSearchParams(window.location.search),e=t.get("action");return e!==null?(t.delete("action"),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+t.toString()),e):typeof localStorage.getItem("lernsax-page")!="string"?"":localStorage.getItem("lernsax-page")},switchPage(t){localStorage.setItem("lernsax-page",t),this.page=t},async hasValidCredentials(){const t=await g("/Lernsax/HasValidCredentials").then(e=>e.json());return t.isSuccess?t.body:!1},dbSetup(){let t=window.indexedDB.open("LernsaxDB",1);t.onerror=e=>resolve(),t.onsuccess=e=>{window.lernsaxDB=e.target.result},t.onupgradeneeded=e=>{window.lernsaxDB=e.target.result,window.lernsaxDB.createObjectStore("mails",{keyPath:"mailId"}).createIndex("mailBody","mailBody",{unique:!1})}}}},Vt=Object.assign(Wt,{__name:"Index",setup(t){return(e,a)=>(o(),r("div",{class:_(["lernsax-page",e.mq.current])},[s("div",Ft,[d(ae,{onSelect:a[0]||(a[0]=n=>e.switchPage(n.key)),default:e.page,items:e.items},null,8,["default","items"])]),s("div",Ut,[e.page==="settings"?(o(),b(ht,{key:0,methodOnMount:e.settingsMethodOnMount,onChangeColorScheme:a[1]||(a[1]=n=>e.$emit("changeColorScheme",n))},null,8,["methodOnMount"])):u("",!0),e.page==="email"?(o(),b(zt,{key:1,methodOnMount:e.settingsMethodOnMount},null,8,["methodOnMount"])):u("",!0)])],2))}});var Kt=w(Vt,[["__scopeId","data-v-236a9a9c"]]);const Gt={class:"main",ref:"notif"},Jt={class:"center page-switch-container"},Qt={key:0},Zt={data(){return{isLoggedIn:null,page:null,modalTitle:"",modalContent:"",showModal:!1,modalMode:"",modalButtons:[],switchModel:new D([new p("sub","Abo Seite"),new p("plan","Plan Seite"),new p("lernsax","Lernsax")],"plan"),isHashResetResponseModalOpen:!1,colorScheme:"darkmode"}},provide(){return{colorScheme:()=>this.colorScheme}},async beforeMount(){await this.isAuthenticated(),await this.handleHashReset(),await this.getPage()},async mounted(){this.loadColorScheme(localStorage.getItem("color-scheme"))},methods:{async handleHashReset(){return new Promise(async(t,e)=>{const a=new URLSearchParams(window.location.search),n=a.get("code");return n===null||(a.delete("code"),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+a.toString()),await this.resetHash(n)),t()})},async resetHash(t){return new Promise(async(e,a)=>{const n=new FormData;n.append("key",t),this.modalButtons=[],this.modalMode="hashResetResponse";let i;try{if(i=await g("/User/ResetHash",{method:"POST",body:n}).then(l=>l.json()),i.isSuccess||this.isLoggedIn)return this.isHashResetResponseModalOpen=!0,this.modalTitle="Anmeldung erfolgreich",this.modalContent=`<b>ACHTUNG:</b> Folge den Anweisungen um Push Nachrichten zu erhalten:<br>
                     1. Scrolle nach unten und w\xE4hle "Push Nachrichten" statt "Email" aus und erlaube die Benachrichtigungen.<br>
                     2. CHROME: Dr\xFCcke auf die 3 Punkte oben rechts und anschlie\xDFend auf "App installieren" (Keine Angst, das ist nur diese Webseite in App-Form - rund 0,5 MB)<br>
                     SONST: F\xFCge die Webseite zum Startbildschirm hinzu
                     `,this.showModal=!0,sessionStorage.setItem("notif-page","plan"),await this.isAuthenticated(),e();this.modalTitle="Anmeldung fehlgeschlagen",this.modalContent=i.message}catch{this.modalTitle="Anmeldung fehlgeschlagen",this.modalContent="Leider ist etwas schief gelaufen"}return this.showModal=!0,e()})},closeModal(){this.showModal=!1,this.modalMode==="hashResetResponse"&&(this.isHashResetResponseModalOpen=!1)},async getPage(){let t=sessionStorage.getItem("notif-page");const e=new URLSearchParams(window.location.search);if(e.get("page")!==null&&(t=e.get("page"),e.delete("page"),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+e.toString())),this.isLoggedIn){this.page=this.switchModel.options.findIndex(a=>a.key===t)===-1?"sub":t;return}this.page="sub"},async isAuthenticated(){if(!navigator.onLine){this.isLoggedIn=localStorage.getItem("user-login-status")==="true";return}try{let t=await g("/User/IsAuthenticated").then(e=>e.json());if(t.isSuccess===!0){this.isLoggedIn=t.body,localStorage.setItem("user-login-status","true");return}}catch{}localStorage.setItem("user-login-status","false"),this.isLoggedIn=!1},switchPage(t){sessionStorage.setItem("notif-page",t),this.page=t},requestHashResetModal(){this.modalTitle="Neu anmelden",this.modalContent=`Wenn du dich bereits einmal angemeldet hast und nun auf die Vertretungsplandaten zugreifen m\xF6chtest bist du hier richtig. Wenn du auf den Knopf dr\xFCckst, erh\xE4lst du eine Email, mit einem Link, der dich wieder anmeldet.<br><br>
         `,this.modalButtons=[new x("Email senden","btn",()=>{(async()=>(await f(300),this.requestHashReset()))()})],this.modalMode="hashReset",this.showModal=!0},async requestHashReset(){const t=document.getElementById("hashreset-mail-input").value;this.modalMode="none",await f(0),this.modalButtons=[];let e,a=new FormData;a.append("mail",t);try{if(e=await g("/User/RequestHashReset",{method:"POST",body:a}).then(n=>n.json()),this.modalContent=e.message,e.isSuccess){this.modalTitle="Erfolg",this.showModal=!0;return}}catch{this.modalContent="Leider ist etwas schief gelaufen."}this.modalButtons=[new x("Erneut versuchen","btn",()=>{(async()=>(await f(300),this.requestHashResetModal()))()})],this.modalTitle="Fehlschlag",this.showModal=!0},loadColorScheme(t){this.colorScheme=t==="lightmode"?"lightmode":"darkmode",localStorage.setItem("color-scheme",this.colorScheme);const n=t==="lightmode"?{bg:"#fff","bg-medium":"#eee","col-light":"#ddd","col-dark":"#ccc",font:"#000"}:{bg:"#181818","bg-medium":"#222","col-dark":"#333","col-light":"#444",font:"#ccc"};for(const i in n)this.$refs.notif.style.setProperty(`--${i}`,n[i])}}},Xt=Object.assign(Zt,{__name:"Index",setup(t){return(e,a)=>(o(),r("div",Gt,[s("div",Jt,[e.isLoggedIn?(o(),b(P,{key:0,options:e.switchModel.options,default:e.page,value:e.page,onSwitch:e.switchPage},null,8,["options","default","value","onSwitch"])):u("",!0)]),e.page===null?(o(),r("div",Qt)):e.page==="plan"?(o(),b(ot,{key:1,isHashResetResponseModalOpen:e.isHashResetResponseModalOpen,onChangeColorScheme:e.loadColorScheme},null,8,["isHashResetResponseModalOpen","onChangeColorScheme"])):e.page==="sub"?(o(),b(Ce,{key:2,onRequestHashReset:a[0]||(a[0]=n=>e.requestHashResetModal())})):e.page==="lernsax"?(o(),b(Kt,{key:3,onChangeColorScheme:e.loadColorScheme},null,8,["onChangeColorScheme"])):u("",!0),d(B,{isOpen:e.showModal,onClose:a[1]||(a[1]=()=>e.closeModal()),title:e.modalTitle,content:e.modalContent,buttons:e.modalButtons},{default:k(()=>[e.modalMode==="hashReset"?(o(),b(y,{key:0,isInvert:!0,label:"Email Addresse",id:"hashreset-mail-input"})):u("",!0)]),_:1},8,["isOpen","title","content","buttons"])],512))}});var sa=w(Xt,[["__scopeId","data-v-3d0ceb1c"]]);export{sa as default};
